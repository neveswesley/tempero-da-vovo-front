<form [formGroup]="form" (ngSubmit)="submit()">
  <button type="button" class="back-button" (click)="goBack()">
    <span class="back-icon">&lt;</span>
    <span>Voltar</span>
  </button>

  <h2>Criar produto</h2>
  <h3>Insira corretamente as informações do produto.</h3>

  <!-- NOME -->
  <label>Nome do produto</label>
  <input type="text" placeholder="Ex: Filé de Frango Grelhado" formControlName="name" />

  <!-- DESCRIÇÃO -->
  <label>Descrição</label>
  <textarea placeholder="Ex: Temperado com alho e ervas." formControlName="description"></textarea>

  <!-- PREÇO -->
  <label class="label">Preço</label>
  <div class="price-container">
    <input
      type="text"
      formControlName="price"
      placeholder="0.00"
      (input)="onPriceInput($event)"
      (blur)="onPriceBlur()"
      (focus)="onPriceFocus($event)"
      inputmode="decimal"
    />
  </div>

  <!-- SELECT DE CATEGORIA (quando NÃO veio da URL) -->
  <div *ngIf="!categoryLockedFromUrl">
    <label>Categoria</label>

    <select formControlName="categoryId">
      <option *ngFor="let cat of categories" [value]="cat.categoryId">
        {{ cat.categoryName }}
      </option>
    </select>

    <small
      *ngIf="!loadingCategories && categories.length === 0"
      style="color: #f44336; display: block; margin-top: -12px; margin-bottom: 16px"
    >
      Nenhuma categoria disponível. Crie categorias primeiro!
    </small>
  </div>

  <!-- CATEGORIA TRAVADA (quando veio da URL) -->
  <div *ngIf="categoryLockedFromUrl" class="category-locked-info">
    <label>Categoria</label>

    <div class="locked-category-display">
      <svg class="lock-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <rect x="5" y="11" width="14" height="10" rx="2" stroke="currentColor" stroke-width="2" />
        <path
          d="M8 11V7a4 4 0 0 1 8 0v4"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
        />
      </svg>

      <span class="locked-category-name" *ngIf="!loadingCategories">
        {{ getSelectedCategoryName() }}
      </span>

      <span class="locked-category-name loading" *ngIf="loadingCategories"> Carregando... </span>
    </div>

    <small class="locked-message"> Produto será adicionado nesta categoria </small>
  </div>

  <!-- IMAGEM -->
  <div class="image-upload-container">
    <label class="image-label">Imagem do produto</label>

    <div *ngIf="imagePreview" class="image-preview">
      <img [src]="imagePreview" alt="Preview" class="preview-image" />

      <div class="image-info">
        <span class="file-name">{{ selectedFile?.name }}</span>

        <div class="image-actions">
          <label for="file-input" class="icon-button edit" title="Trocar imagem">
            <svg viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor">
              <path
                d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
            </svg>
          </label>

          <button
            type="button"
            class="icon-button delete"
            title="Remover imagem"
            (click)="removeImage()"
          >
            <svg viewBox="0 0 24 24" class="icon" fill="none" stroke="currentColor">
              <polyline
                points="3 6 5 6 21 6"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <path
                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              />
              <line x1="10" y1="11" x2="10" y2="17" stroke-width="2" stroke-linecap="round" />
              <line x1="14" y1="11" x2="14" y2="17" stroke-width="2" stroke-linecap="round" />
            </svg>
          </button>
        </div>
      </div>
    </div>

    <label *ngIf="!imagePreview" for="file-input" class="upload-button">
      ➕ Adicionar imagem
    </label>

    <input id="file-input" type="file" accept="image/*" hidden (change)="onFileSelected($event)" />
  </div>

  <!-- SUBMIT -->
  <button type="submit" [disabled]="form.invalid || loadingCategories">Criar produto</button>
</form>
